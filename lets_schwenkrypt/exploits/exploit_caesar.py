import sys
from gameserver import GameServer

PORT = 4711

def exploit(cipher, parameters):
    key = parameters["key"]
    plain = bytes([(x - key) % 256 for x in cipher])
    return plain.decode("utf-8")


if __name__ == "__main__":
    assert len(sys.argv) >= 3, "Needs flag ids in third argument"
    target = sys.argv[1]
    flagIds = sys.argv[2].split(",")

    for flagId in flagIds:
        cipher, params = GameServer.retrieveCipher(target, PORT, flagId)
        if params["method"] == "caesar":
            plain = exploit(cipher, params)
            print(plain)